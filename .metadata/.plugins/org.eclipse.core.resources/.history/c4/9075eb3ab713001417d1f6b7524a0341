package com.bloc.blocs;

import org.andengine.engine.camera.Camera;
import org.andengine.entity.primitive.Rectangle;
import org.andengine.entity.scene.Scene;
import org.andengine.entity.scene.background.Background;
import org.andengine.entity.shape.IAreaShape;
import org.andengine.extension.physics.box2d.PhysicsConnector;
import org.andengine.extension.physics.box2d.PhysicsFactory;
import org.andengine.extension.physics.box2d.PhysicsWorld;

import android.hardware.SensorManager;

import com.badlogic.gdx.math.Vector2;
import com.badlogic.gdx.physics.box2d.Body;
import com.badlogic.gdx.physics.box2d.BodyDef.BodyType;
import com.badlogic.gdx.physics.box2d.FixtureDef;



public class PlayScene extends Scene {
	
	Camera mCamera;
	public GamePiece gamePiece;
	
	public PhysicsWorld physicsWorld;
	
	public final static int BOARD_WIDTH = 300;
	public final static int BOARD_HEIGHT = 660;
	public final static int TILE_DIMEN = 30;
	public final static int LEFT_X = 90;
	public final static int RIGHT_X = 390;
	public final static int TOP_Y= 60;
	public final static int BOTTOM_Y = 660;

	public PlayScene() {
		setBackground(new Background(0.1f, 0.1f, 0.1f));
		mCamera = Blocs.getSharedInstance().mCamera;
		
		this.physicsWorld = new PhysicsWorld(new Vector2(0, SensorManager.GRAVITY_EARTH), false);
		
		/*Rectangle playField = new Rectangle(60, 60, 300, 660, Blocs.getSharedInstance().getVertexBufferObjectManager());
		playField.setColor(0.93f, 0.877f, 0.822f);
		playField.setPosition(90, 60);
		attachChild(playField); */
		
		//x, y, width, height
		final Rectangle ground = new Rectangle(LEFT_X, BOTTOM_Y, BOARD_WIDTH, 2, Blocs.getSharedInstance().getVertexBufferObjectManager());
		final Rectangle left = new Rectangle(LEFT_X, TOP_Y, 2, BOARD_HEIGHT, Blocs.getSharedInstance().getVertexBufferObjectManager());
		final Rectangle right = new Rectangle(RIGHT_X, TOP_Y, 2, BOARD_HEIGHT, Blocs.getSharedInstance().getVertexBufferObjectManager());
		
		final FixtureDef wallFixtureDef = PhysicsFactory.createFixtureDef(0, 0.5f, 0.5f);
		PhysicsFactory.createBoxBody(this.physicsWorld, ground, BodyType.StaticBody, wallFixtureDef);
		PhysicsFactory.createBoxBody(this.physicsWorld, left, BodyType.StaticBody, wallFixtureDef);
		PhysicsFactory.createBoxBody(this.physicsWorld, right, BodyType.StaticBody, wallFixtureDef);
		
		attachChild(ground);
		attachChild(left);
		attachChild(right);
		
		final FixtureDef objectFixtureDef = PhysicssFactory.createFixtureDef(1,  0.5f,  0.5f);
		gamePiece = GamePiece.getSharedInstance();
		final Body body = PhysicsFactory.createBoxBody(physicsWorld, (IAreaShape) gamePiece, BodyType.DynamicBody, objectFixtureDef);
		physicsWorld.registerPhysicsConnector(new PhysicsConnector((IAreaShape) gamePiece,  body, true, true));
		attachChild(gamePiece.piece);
		
		Blocs.getSharedInstance().setCurrentScene(this);
		
		//registerUpdateHandler(new GameLoopUpdateHandler());
		registerUpdateHandler(physicsWorld);
	}
	
	public void releasePiece() {
		gamePiece.releasePiece(Blocs.getSharedInstance().gravity_rate);
	}
}
